var SpotlightBG=function(u){"use strict";const w={logoPath:"/OFF-PISTE.glb",logoScale:2,logoRotation:{x:0,y:0,z:0},cameraFOV:50,cameraDistance:6,maxCameraOffset:{x:8,y:1.4,z:3},cameraNear:.1,cameraFar:1e3,trackingSensitivity:.8,smoothingFactor:.06,faceDetectionFPS:20,cameraRequestDelay:1e3,fallbackAnimationSpeed:3e-4,fallbackAnimationRadius:{x:.4,y:.25},backgroundColor:657935,showGrid:!1,gridSize:50,gridDivisions:40,gridColor:2763342,gridCenterColor:4868734,showParticles:!1,particleCount:200,particleSize:.04,particleColor:6974110,particleSpread:25,particleDrift:3e-4,terminalOverlay:!0,showCornerBrackets:!0,showSystemText:!1,scanLineOpacity:.015,parallaxLayers:!0,parallaxMultipliers:{deep:.1,mid:.3,near:.5,ui:.6},ambientLightColor:3158080,ambientLightIntensity:.25,mainLightColor:16777215,mainLightIntensity:2.5,mainLightPosition:{x:5,y:8,z:5},rimLightColor:8425727,rimLightIntensity:1.5,rimLightPosition:{x:-5,y:2,z:-5},maxPixelRatio:2,antialias:!0,gyroMaxTilt:40,gyroSensitivity:1,containerId:"hero-canvas",spotlightRadius:.3,spotlightSoftness:.2,dotDensity:70,dotSize:.9,crossRatio:0,colorDark:"#000000",colorLight:"#666666",dotColorDark:"#000000",dotColorLight:"#666666"};function b(){const o=typeof window<"u"?window.IMMERSIVE_CONFIG||{}:{};return p(w,o)}function p(o,e){const t={...o};for(const i in e)e[i]!==null&&typeof e[i]=="object"&&!Array.isArray(e[i])?t[i]=p(o[i]||{},e[i]):t[i]=e[i];return t}const x=`
  attribute vec2 a_position;
  varying vec2 v_uv;
  
  void main() {
    v_uv = a_position * 0.5 + 0.5;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,k=`
  precision highp float;
  
  varying vec2 v_uv;
  
  uniform vec2 u_resolution;
  uniform vec2 u_userPosition;
  uniform float u_time;
  
  // Settings
  uniform float u_spotlightRadius;
  uniform float u_spotlightSoftness;
  uniform float u_dotDensity;
  uniform float u_dotSize;
  uniform float u_crossRatio;
  
  // Colors
  uniform vec3 u_colorDark;
  uniform vec3 u_colorLight;
  uniform vec3 u_dotColorDark;
  uniform vec3 u_dotColorLight;
  
  // Simplex-like noise
  vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
  vec2 mod289(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
  vec3 permute(vec3 x) { return mod289(((x*34.0)+1.0)*x); }
  
  float snoise(vec2 v) {
    const vec4 C = vec4(0.211324865405187, 0.366025403784439,
                        -0.577350269189626, 0.024390243902439);
    vec2 i  = floor(v + dot(v, C.yy));
    vec2 x0 = v - i + dot(i, C.xx);
    vec2 i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
    vec4 x12 = x0.xyxy + C.xxzz;
    x12.xy -= i1;
    i = mod289(i);
    vec3 p = permute(permute(i.y + vec3(0.0, i1.y, 1.0)) + i.x + vec3(0.0, i1.x, 1.0));
    vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);
    m = m*m; m = m*m;
    vec3 x = 2.0 * fract(p * C.www) - 1.0;
    vec3 h = abs(x) - 0.5;
    vec3 ox = floor(x + 0.5);
    vec3 a0 = x - ox;
    m *= 1.79284291400159 - 0.85373472095314 * (a0*a0 + h*h);
    vec3 g;
    g.x = a0.x * x0.x + h.x * x0.y;
    g.yz = a0.yz * x12.xz + h.yz * x12.yw;
    return 130.0 * dot(m, g);
  }
  
  // Fractal noise with subtle flow and time
  float fluidNoise(vec2 p, vec2 flow, float time) {
    float value = 0.0;
    float amplitude = 0.55;
    float frequency = 1.0;
    
    // Very slow organic drift
    float drift = time * 0.08;
    
    for (int i = 0; i < 5; i++) {
      // Each octave flows slightly differently - subtle
      vec2 octaveFlow = flow * (1.0 + float(i) * 0.05);
      vec2 octaveDrift = vec2(
        sin(drift + float(i) * 0.5) * 0.15,
        cos(drift * 0.7 + float(i) * 0.3) * 0.15
      );
      
      value += amplitude * snoise(p * frequency + octaveFlow + octaveDrift);
      amplitude *= 0.55;
      frequency *= 1.9;
    }
    return value;
  }
  
  // Subtle coordinate warping for organic feel
  vec2 warpCoord(vec2 p, vec2 flow, float time) {
    float warpStrength = 0.08;  // More subtle
    float wx = snoise(p * 2.0 + flow * 0.3 + time * 0.05);
    float wy = snoise(p * 2.0 + flow * 0.3 + time * 0.05 + 100.0);
    return p + vec2(wx, wy) * warpStrength;
  }
  
  // Draw a perfect circle dot
  float drawDot(vec2 uv, vec2 center, float radius) {
    float dist = length(uv - center);
    // Sharp edge for perfect circle
    return 1.0 - smoothstep(radius - 0.02, radius, dist);
  }
  
  void main() {
    vec2 uv = v_uv;
    float aspect = u_resolution.x / u_resolution.y;
    
    // Aspect-corrected UV
    vec2 uvAspect = vec2(uv.x * aspect, uv.y);
    
    // User position creates SUBTLE flow
    vec2 userOffset = (u_userPosition - 0.5) * 2.0;
    vec2 flow = userOffset * 1.2;  // Much more subtle
    
    // Very slow time for subtle organic movement
    float time = u_time * 0.2;
    
    // Grid for dots
    float cellSize = 1.0 / u_dotDensity;
    vec2 gridUV = uv / cellSize;
    vec2 cellIndex = floor(gridUV);
    vec2 cellUV = fract(gridUV);
    
    // Cell center for noise sampling
    vec2 cellCenter = (cellIndex + 0.5) * cellSize;
    vec2 cellCenterAspect = vec2(cellCenter.x * aspect, cellCenter.y);
    
    // Subtle coordinate warping for organic blob shapes
    vec2 warpedCoord = warpCoord(cellCenterAspect, flow, time);
    
    // Sample fluid noise at multiple scales - subtle flow influence
    float n1 = fluidNoise(warpedCoord * 2.0, flow * 0.4, time);
    float n2 = fluidNoise(warpedCoord * 3.5 + 50.0, flow * 0.5, time * 1.1);
    float n3 = fluidNoise(warpedCoord * 1.2 + 25.0, flow * 0.3, time * 0.8);
    
    // Combine noise layers - creates organic flowing blobs
    float combined = n1 * 0.45 + n2 * 0.35 + n3 * 0.35;
    
    // Smooth threshold for soft blob edges
    float blob = smoothstep(-0.2, 0.5, combined);
    
    // Subtle detail layer
    float detail = snoise(warpedCoord * 6.0 + flow * 0.2 + time * 0.1) * 0.1;
    blob = clamp(blob + detail, 0.0, 1.0);
    
    // Smooth curve for more natural falloff
    float influence = blob * blob * (3.0 - 2.0 * blob); // smootherstep
    
    // DYNAMIC DOT SIZE based on influence
    // Min size when dark, max size when bright
    float minDotSize = 0.08;
    float maxDotSize = 0.48;
    float dynamicRadius = mix(minDotSize, maxDotSize, influence) * u_dotSize;
    
    // Draw dot with dynamic size
    vec2 center = vec2(0.5);
    float dot = drawDot(cellUV, center, dynamicRadius);
    
    // Background
    vec3 bgColor = u_colorDark;
    
    // Dot color - also varies slightly with size for depth
    float colorIntensity = mix(0.5, 1.0, influence);
    vec3 dotColor = u_colorLight * colorIntensity;
    
    // Final color
    vec3 finalColor = mix(bgColor, dotColor, dot);
    
    gl_FragColor = vec4(finalColor, 1.0);
  }
`;function d(o){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(o);return e?[parseInt(e[1],16)/255,parseInt(e[2],16)/255,parseInt(e[3],16)/255]:[0,0,0]}function P(){const o="ontouchstart"in window||navigator.maxTouchPoints>0,e=window.matchMedia("(max-width: 1024px)").matches,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);return o&&e||t}function S(){return"DeviceOrientationEvent"in window}function T(){return typeof DeviceOrientationEvent<"u"&&typeof DeviceOrientationEvent.requestPermission=="function"}function C(){try{const o=document.createElement("canvas");return!!(o.getContext("webgl")||o.getContext("experimental-webgl"))}catch{return!1}}function z(){return window.matchMedia("(prefers-reduced-motion: reduce)").matches}function D(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}function L(o=2){return Math.min(window.devicePixelRatio||1,o)}class M{constructor(e){this.config=e,this.canvas=null,this.gl=null,this.program=null,this.positionBuffer=null,this.uniforms={},this.userPosition={x:.5,y:.5},this.targetPosition={x:.5,y:.5},this.startTime=performance.now()}init(e){try{return this.canvas=document.createElement("canvas"),this.canvas.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
        pointer-events: none;
      `,e.appendChild(this.canvas),this.gl=this.canvas.getContext("webgl",{alpha:!1,antialias:!1,depth:!1,stencil:!1,preserveDrawingBuffer:!1}),this.gl?(this.resize(),this.createProgram()?(this.createGeometry(),this.getUniformLocations(),this.setUniforms(),!0):!1):(console.error("WebGL not supported"),!1)}catch(t){return console.error("Failed to initialize SpotlightScene:",t),!1}}createProgram(){const e=this.gl,t=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(t,x),e.compileShader(t),!e.getShaderParameter(t,e.COMPILE_STATUS))return console.error("Vertex shader compile error:",e.getShaderInfoLog(t)),!1;const i=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(i,k),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?(this.program=e.createProgram(),e.attachShader(this.program,t),e.attachShader(this.program,i),e.linkProgram(this.program),e.getProgramParameter(this.program,e.LINK_STATUS)?(e.deleteShader(t),e.deleteShader(i),!0):(console.error("Shader program link error:",e.getProgramInfoLog(this.program)),!1)):(console.error("Fragment shader compile error:",e.getShaderInfoLog(i)),!1)}createGeometry(){const e=this.gl,t=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);this.positionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW);const i=e.getAttribLocation(this.program,"a_position");e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0)}getUniformLocations(){const e=this.gl;e.useProgram(this.program),this.uniforms={resolution:e.getUniformLocation(this.program,"u_resolution"),userPosition:e.getUniformLocation(this.program,"u_userPosition"),time:e.getUniformLocation(this.program,"u_time"),spotlightRadius:e.getUniformLocation(this.program,"u_spotlightRadius"),spotlightSoftness:e.getUniformLocation(this.program,"u_spotlightSoftness"),dotDensity:e.getUniformLocation(this.program,"u_dotDensity"),dotSize:e.getUniformLocation(this.program,"u_dotSize"),crossRatio:e.getUniformLocation(this.program,"u_crossRatio"),colorDark:e.getUniformLocation(this.program,"u_colorDark"),colorLight:e.getUniformLocation(this.program,"u_colorLight"),dotColorDark:e.getUniformLocation(this.program,"u_dotColorDark"),dotColorLight:e.getUniformLocation(this.program,"u_dotColorLight")}}setUniforms(){const e=this.gl,t=this.config;e.useProgram(this.program),e.uniform2f(this.uniforms.resolution,this.canvas.width,this.canvas.height),e.uniform1f(this.uniforms.spotlightRadius,t.spotlightRadius),e.uniform1f(this.uniforms.spotlightSoftness,t.spotlightSoftness),e.uniform1f(this.uniforms.dotDensity,t.dotDensity),e.uniform1f(this.uniforms.dotSize,t.dotSize),e.uniform1f(this.uniforms.crossRatio,t.crossRatio);const i=d(t.colorDark),s=d(t.colorLight),n=d(t.dotColorDark),r=d(t.dotColorLight);e.uniform3fv(this.uniforms.colorDark,i),e.uniform3fv(this.uniforms.colorLight,s),e.uniform3fv(this.uniforms.dotColorDark,n),e.uniform3fv(this.uniforms.dotColorLight,r)}setUserPosition(e,t){this.targetPosition.x=(e+1)*.5,this.targetPosition.y=(t+1)*.5}resize(){const e=L(this.config.maxPixelRatio||2),t=window.innerWidth,i=window.innerHeight;this.canvas.width=t*e,this.canvas.height=i*e,this.canvas.style.width=`${t}px`,this.canvas.style.height=`${i}px`,this.gl&&(this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.uniforms.resolution&&(this.gl.useProgram(this.program),this.gl.uniform2f(this.uniforms.resolution,this.canvas.width,this.canvas.height)))}render(){const e=this.gl;if(!e||!this.program)return;const t=this.config.smoothingFactor||.08;this.userPosition.x+=(this.targetPosition.x-this.userPosition.x)*t,this.userPosition.y+=(this.targetPosition.y-this.userPosition.y)*t,e.useProgram(this.program),e.uniform2f(this.uniforms.userPosition,this.userPosition.x,this.userPosition.y);const i=(performance.now()-this.startTime)/1e3;e.uniform1f(this.uniforms.time,i),e.drawArrays(e.TRIANGLES,0,6)}dispose(){const e=this.gl;e&&(this.positionBuffer&&e.deleteBuffer(this.positionBuffer),this.program&&e.deleteProgram(this.program),this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.gl=null,this.canvas=null)}}function f(o,e,t){return Math.min(Math.max(o,e),t)}function R(o,e,t){return t===e?0:(o-e)/(t-e)}function a(o,e,t,i,s){return i+(s-i)*R(o,e,t)}class A{constructor(e,t){this.config=e,this.onUpdate=t,this.video=null,this.canvas=null,this.ctx=null,this.faceDetection=null,this.isRunning=!1,this.isInitialized=!1,this.detectionInterval=null,this.previewContainer=null,this.lastPosition={x:0,y:0,z:0},this.baseFaceSize=null,this.smoothedPosition={x:0,y:0,z:0}}async initialize(){try{return console.log("Initializing face tracker..."),this.video=document.createElement("video"),this.video.setAttribute("playsinline",""),this.video.setAttribute("autoplay",""),this.video.setAttribute("muted",""),this.video.style.cssText="position: absolute; opacity: 0; pointer-events: none;",document.body.appendChild(this.video),await this.loadMediaPipe(),console.log("Face tracker initialized"),this.isInitialized=!0,!0}catch(e){return console.warn("Failed to initialize face detection:",e),!1}}async loadMediaPipe(){return new Promise((e,t)=>{if(window.FaceDetection){this.setupFaceDetection(),e();return}const i=document.createElement("script");i.src="https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/face_detection.js",i.crossOrigin="anonymous",i.onload=()=>{console.log("MediaPipe Face Detection loaded"),this.setupFaceDetection(),e()},i.onerror=s=>{console.error("Failed to load MediaPipe:",s),t(s)},document.head.appendChild(i)})}setupFaceDetection(){this.faceDetection=new window.FaceDetection({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/${e}`}),this.faceDetection.setOptions({model:"short",minDetectionConfidence:.5}),this.faceDetection.onResults(e=>this.handleResults(e))}async start(){if(!this.isInitialized&&!await this.initialize())return!1;try{console.log("Requesting camera access...");const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:640},height:{ideal:480}}});return console.log("Camera access granted"),this.video.srcObject=e,await new Promise((t,i)=>{this.video.onloadedmetadata=()=>{this.video.play().then(t).catch(i)},this.video.onerror=i,setTimeout(()=>i(new Error("Video load timeout")),5e3)}),console.log("Video stream ready:",this.video.videoWidth,"x",this.video.videoHeight),this.createPreview(),this.isRunning=!0,this.startDetectionLoop(),console.log("Face tracking started"),!0}catch(e){return console.warn("Camera access denied or unavailable:",e),!1}}createPreview(){this.previewContainer=document.createElement("div"),this.previewContainer.style.cssText=`
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 200px;
      height: 150px;
      border-radius: 12px;
      overflow: hidden;
      border: 2px solid rgba(255, 255, 255, 0.2);
      z-index: 1000;
      background: #000;
    `;const e=document.createElement("video");e.srcObject=this.video.srcObject,e.setAttribute("playsinline",""),e.setAttribute("autoplay",""),e.setAttribute("muted",""),e.style.cssText=`
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scaleX(-1);
    `,e.play(),this.previewContainer.appendChild(e),document.body.appendChild(this.previewContainer)}startDetectionLoop(){const e=1e3/this.config.faceDetectionFPS,t=async()=>{if(this.isRunning){if(this.video.readyState>=2&&this.faceDetection)try{await this.faceDetection.send({image:this.video})}catch(i){console.warn("Face detection error:",i)}this.detectionInterval=setTimeout(t,e)}};t()}handleResults(e){if(!e.detections||e.detections.length===0){this.smoothedPosition.x*=.92,this.smoothedPosition.y*=.92,this.smoothedPosition.z*=.92,this.onUpdate&&this.onUpdate(this.smoothedPosition.x,this.smoothedPosition.y,this.smoothedPosition.z);return}const i=e.detections[0].boundingBox,s=i.xCenter,n=i.yCenter,r=i.width*i.height;this.baseFaceSize===null&&(this.baseFaceSize=r);const c=a(s,0,1,1,-1),l=a(n,0,1,1,-1),m=r/this.baseFaceSize,g=f(a(m,.6,1.6,1,-1),-1,1),h=.15;this.smoothedPosition.x+=(c-this.smoothedPosition.x)*h,this.smoothedPosition.y+=(l-this.smoothedPosition.y)*h,this.smoothedPosition.z+=(g-this.smoothedPosition.z)*h,this.onUpdate&&this.onUpdate(this.smoothedPosition.x,this.smoothedPosition.y,this.smoothedPosition.z)}stop(){this.isRunning=!1,this.detectionInterval&&(clearTimeout(this.detectionInterval),this.detectionInterval=null),this.video&&this.video.srcObject&&(this.video.srcObject.getTracks().forEach(t=>t.stop()),this.video.srcObject=null),this.video&&this.video.parentNode&&this.video.parentNode.removeChild(this.video),this.previewContainer&&this.previewContainer.parentNode&&this.previewContainer.parentNode.removeChild(this.previewContainer)}isActive(){return this.isRunning}getLastPosition(){return{...this.smoothedPosition}}recalibrate(){this.baseFaceSize=null}setPreviewVisible(e){this.previewContainer&&(this.previewContainer.style.display=e?"block":"none")}}class _{constructor(e,t){this.config=e,this.onUpdate=t,this.isRunning=!1,this.hasPermission=!1,this.needsPermission=this.checkNeedsPermission(),this.currentOrientation={alpha:0,beta:0,gamma:0},this.handleOrientation=this.handleOrientation.bind(this)}checkNeedsPermission(){return typeof DeviceOrientationEvent<"u"&&typeof DeviceOrientationEvent.requestPermission=="function"}async requestPermission(){if(!this.needsPermission)return this.hasPermission=!0,!0;try{const e=await DeviceOrientationEvent.requestPermission();return this.hasPermission=e==="granted",this.hasPermission}catch(e){return console.warn("Gyroscope permission denied:",e),this.hasPermission=!1,!1}}isAvailable(){return"DeviceOrientationEvent"in window}async start(){return this.isAvailable()?this.needsPermission&&!this.hasPermission&&!await this.requestPermission()?!1:(window.addEventListener("deviceorientation",this.handleOrientation),this.isRunning=!0,!0):(console.warn("DeviceOrientation API not available"),!1)}handleOrientation(e){const{beta:t,gamma:i}=e,{gyroMaxTilt:s,gyroSensitivity:n}=this.config;if(t===null||i===null)return;this.currentOrientation={alpha:e.alpha||0,beta:t,gamma:i};const c=t-45,l=f(c,-s,s),m=f(i,-s,s),g=a(m,-s,s,-1,1)*n,h=a(-l,-s,s,-1,1)*n;this.onUpdate&&this.onUpdate(g,h,0)}stop(){window.removeEventListener("deviceorientation",this.handleOrientation),this.isRunning=!1}isActive(){return this.isRunning}requiresUserGesture(){return this.needsPermission&&!this.hasPermission}getCurrentOrientation(){return{...this.currentOrientation}}}class E{constructor(e,t){this.config=e,this.onUpdate=t,this.isRunning=!1,this.startTime=0,this.frequency={x:1,y:2},this.phase={x:0,y:Math.PI/4}}start(){this.isRunning=!0,this.startTime=performance.now()}stop(){this.isRunning=!1}update(e){if(!this.isRunning)return;const t=e-this.startTime,i=this.config.fallbackAnimationSpeed,s=this.config.fallbackAnimationRadius,n=t*i,r=Math.sin(n*this.frequency.x+this.phase.x)*s.x,c=Math.sin(n*this.frequency.y+this.phase.y)*s.y,l=Math.sin(n*.3)*.1;this.onUpdate&&this.onUpdate(r,c+l,0)}isActive(){return this.isRunning}setSpeed(e){this.config.fallbackAnimationSpeed=e}setRadius(e){this.config.fallbackAnimationRadius=e}}class v{constructor(){this.config=b(),this.container=null,this.scene=null,this.faceTracker=null,this.gyroscopeTracker=null,this.fallbackAnimator=null,this.activeTracker=null,this.mousePosition={x:0,y:0},this.isMouseTracking=!1,this.isRunning=!1,this.animationId=null,this.reducedMotion=z(),this.permissionButton=null}async init(){if(!C())return console.warn("WebGL not supported"),!1;this.container=document.getElementById(this.config.containerId),this.container||(console.log(`Container #${this.config.containerId} not found, creating it`),this.container=document.createElement("div"),this.container.id=this.config.containerId,this.container.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
        pointer-events: none;
      `,document.body.insertBefore(this.container,document.body.firstChild));try{return this.scene=new M(this.config),this.scene.init(this.container)?(await this.setupTracking(),this.setupEventListeners(),this.start(),!0):(console.error("Failed to initialize spotlight scene"),!1)}catch(e){return console.error("Failed to initialize spotlight background:",e),this.cleanup(),!1}}async setupTracking(){const e=(t,i,s)=>{this.scene&&this.scene.setUserPosition(t,i)};if(this.fallbackAnimator=new E(this.config,e),this.reducedMotion){console.log("Reduced motion preferred - using minimal fallback"),this.fallbackAnimator.setSpeed(this.config.fallbackAnimationSpeed*.3),this.fallbackAnimator.setRadius({x:.1,y:.05}),this.fallbackAnimator.start(),this.activeTracker="fallback";return}P()?await this.setupMobileTracking(e):await this.setupDesktopTracking(e)}async setupMobileTracking(e){if(!S()){console.log("Gyroscope not available - using mouse/touch fallback"),this.enableMouseTracking();return}this.gyroscopeTracker=new _(this.config,e),T()?this.showPermissionButton("motion"):await this.gyroscopeTracker.start()?(this.activeTracker="gyroscope",console.log("Gyroscope tracking active")):this.enableMouseTracking()}async setupDesktopTracking(e){if(!D()){console.log("Camera access not available - using mouse fallback"),this.enableMouseTracking();return}this.faceTracker=new A(this.config,e),this.enableMouseTracking(),setTimeout(async()=>{console.log("Attempting to start face tracking..."),await this.faceTracker.start()?(this.disableMouseTracking(),this.faceTracker.setPreviewVisible(!1),this.activeTracker="face",console.log("Face tracking active")):(console.log("Camera denied - continuing with mouse tracking"),this.activeTracker="mouse")},this.config.cameraRequestDelay)}enableMouseTracking(){this.isMouseTracking||(this.isMouseTracking=!0,this.activeTracker="mouse",this.handleMouseMove=e=>{const t=e.clientX/window.innerWidth*2-1,i=-(e.clientY/window.innerHeight*2-1);this.scene&&this.activeTracker==="mouse"&&this.scene.setUserPosition(t,i)},this.handleTouchMove=e=>{if(e.touches.length>0){const t=e.touches[0],i=t.clientX/window.innerWidth*2-1,s=-(t.clientY/window.innerHeight*2-1);this.scene&&this.activeTracker==="mouse"&&this.scene.setUserPosition(i,s)}},this.scene&&this.scene.canvas&&(this.scene.canvas.style.pointerEvents="auto"),window.addEventListener("mousemove",this.handleMouseMove),window.addEventListener("touchmove",this.handleTouchMove,{passive:!0}),console.log("Mouse/touch tracking enabled"))}disableMouseTracking(){this.isMouseTracking&&(this.isMouseTracking=!1,this.handleMouseMove&&window.removeEventListener("mousemove",this.handleMouseMove),this.handleTouchMove&&window.removeEventListener("touchmove",this.handleTouchMove),this.scene&&this.scene.canvas&&(this.scene.canvas.style.pointerEvents="none"),console.log("Mouse/touch tracking disabled"))}showPermissionButton(e){this.permissionButton=document.getElementById("enable-motion"),this.permissionButton||(this.permissionButton=document.createElement("button"),this.permissionButton.id="enable-motion",this.permissionButton.className="enable-motion",this.permissionButton.textContent="Tap to enable motion tracking",this.permissionButton.style.cssText=`
        position: fixed;
        bottom: 2rem;
        left: 50%;
        transform: translateX(-50%);
        padding: 0.75rem 1.5rem;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 2rem;
        color: white;
        font-size: 0.875rem;
        cursor: pointer;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
        z-index: 100;
      `,document.body.appendChild(this.permissionButton)),this.permissionButton.style.display="block";const t=async()=>{e==="motion"&&this.gyroscopeTracker&&await this.gyroscopeTracker.requestPermission()&&await this.gyroscopeTracker.start()&&(this.disableMouseTracking(),this.activeTracker="gyroscope",console.log("Gyroscope tracking active")),this.permissionButton.style.display="none",this.permissionButton.removeEventListener("click",t)};this.permissionButton.addEventListener("click",t),this.enableMouseTracking()}setupEventListeners(){window.addEventListener("resize",()=>this.handleResize()),document.addEventListener("visibilitychange",()=>{document.hidden?this.pause():this.resume()}),window.matchMedia("(prefers-reduced-motion: reduce)").addEventListener("change",t=>{this.reducedMotion=t.matches,this.reducedMotion&&this.fallbackAnimator&&(this.switchToFallback(),this.fallbackAnimator.setSpeed(this.config.fallbackAnimationSpeed*.3))})}handleResize(){this.scene&&this.scene.resize()}switchToFallback(){this.faceTracker&&this.faceTracker.stop(),this.gyroscopeTracker&&this.gyroscopeTracker.stop(),this.disableMouseTracking(),this.fallbackAnimator.start(),this.activeTracker="fallback"}start(){this.isRunning||(this.isRunning=!0,this.animate())}pause(){this.isRunning=!1,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}resume(){this.isRunning||(this.isRunning=!0,this.animate())}animate(){if(!this.isRunning)return;this.animationId=requestAnimationFrame(()=>this.animate());const e=performance.now();this.activeTracker==="fallback"&&this.fallbackAnimator&&this.fallbackAnimator.update(e),this.scene&&this.scene.render()}cleanup(){this.pause(),this.faceTracker&&this.faceTracker.stop(),this.gyroscopeTracker&&this.gyroscopeTracker.stop(),this.disableMouseTracking(),this.scene&&this.scene.dispose(),this.permissionButton&&this.permissionButton.parentNode&&this.permissionButton.parentNode.removeChild(this.permissionButton)}}function F(){try{console.log("Initializing spotlight background...");const o=new v;o.init().then(e=>{e?console.log("Spotlight background initialized successfully"):console.warn("Spotlight background initialization returned false")}).catch(e=>{console.error("Spotlight background initialization failed:",e)}),window.__SPOTLIGHT_BG__=o}catch(o){console.error("Spotlight background error:",o)}}function y(){setTimeout(F,100)}return document.readyState==="loading"?document.addEventListener("DOMContentLoaded",y):y(),u.SpotlightBackground=v,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),u}({});
